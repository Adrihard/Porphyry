<!--
	Ant file [http://ant.apache.org/] 
	To compile and run Porphyry: ant
	To deploy Porphyry: ant deploy -Duser=XXX -Dpass=XXX
	To run unit tests: ant test
-->
<project name="Porphyry v5" default="run">

	<target name="prepare">
		<mkdir dir="build"/>
	</target>
	
	<target name="compile-common" depends="prepare">
		<javac srcdir="src/org/porphyry/model" destdir="build" target="1.5" />
		<java jar="trang.jar" fork="true">
			<arg value="src/org/porphyry/model/Actor.rnc"/>
			<arg value="build/org/porphyry/model/Actor.xsd"/>
		</java>
		<java jar="trang.jar" fork="true">
			<arg value="src/org/porphyry/model/Actors.rnc"/>
			<arg value="build/org/porphyry/model/Actors.xsd"/>
		</java>
		<java jar="trang.jar" fork="true">
			<arg value="src/org/porphyry/model/Entity.rnc"/>
			<arg value="build/org/porphyry/model/Entity.xsd"/>
		</java>
		<java jar="trang.jar" fork="true">
			<arg value="src/org/porphyry/model/Viewpoint.rnc"/>
			<arg value="build/org/porphyry/model/Viewpoint.xsd"/>
		</java>
		<java jar="trang.jar" fork="true">
			<arg value="src/org/porphyry/model/Topic.rnc"/>
			<arg value="build/org/porphyry/model/Topic.xsd"/>
		</java>		
	</target>
	
	<target name="compile" depends="compile-common" description="Compile application sources">
		<javac srcdir="src/org/porphyry/presenter" destdir="build" target="1.5" />
		<javac srcdir="src/org/porphyry/view" destdir="build" target="1.5" />
		<copy todir="build/org/porphyry/view">
			<fileset dir="src/org/porphyry/view" excludes="**/*.java"/> 
		</copy>
	</target>

	<target name="compile-test" depends="compile-common" description="Compile unit tests sources">
		<javac srcdir="src/org/porphyry/test" destdir="build" target="1.5"/>
	</target>
		
	<target name="test" depends="compile-test" description="Start unit tests"> 
		<junit printsummary="yes">
			<batchtest> 
				<fileset dir="build" includes="**/*Test*.class"/> 
			</batchtest> 
		</junit> 
	</target> 

	<target name="run" depends="compile" description="Start application">
		<java classname="org.porphyry.view.Portfolio" 
			classpath="build" fork="true">
			<arg value="http://localhost/viewpoint/1/topic/1/"/>
			<jvmarg value="-Xdock:name=Porphyry"/>
			<sysproperty key="apple.laf.useScreenMenuBar" value="true"/>
		</java>
	</target>
		 
	<target name="dist" depends="compile"
		description="generate the client distribution" >
		<mkdir dir="manifest"/>
		<manifest file="manifest/CLIENT.MF">
			<attribute name="Main-Class" 
				value="org.porphyry.view.Portfolio"/>
		</manifest>
		<mkdir dir="dist"/>
		<jar jarfile="dist/Porphyry.jar" 
			basedir="build"
			manifest="manifest/CLIENT.MF">
			<include name="org/porphyry/model/**"/>
			<include name="org/porphyry/presenter/**"/>
			<include name="org/porphyry/view/**"/>
		</jar>
		<signjar jar="dist/Porphyry.jar"
			keystore="~/${user}.p12" 
			alias="My key" 
			storepass="${pass}"
			storetype="PKCS12"/>
	</target>

	<target name="deploy" depends="dist" description="Publish on SourceForge">
		<scp trust="yes" file="dist/Porphyry.jar" 
		todir="${user}:${pass}@shell.sf.net:/home/groups/p/po/porphyry/htdocs"/>
	</target>
	
	<target name="clean" description="Delete what ant has built"> 
		<delete dir="build"/>
		<delete dir="dist"/>
		<delete dir="manifest"/>
	</target>

</project>